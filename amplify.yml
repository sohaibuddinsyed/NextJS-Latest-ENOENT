version: 1
frontend:
  phases:
    preBuild:
      commands:
        - export NODE_OPTIONS='--max-old-space-size=7000'
        - npm install
    build:
      commands:
        # Run heap profiler during build
        - npm run build:heapprof
    postBuild:
      commands:
        # Heap*.heapprofile file will be created by Node.js
        # Cat the output of the heap profile to build logs
        - cat Heap*.heapprofile
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/* 
